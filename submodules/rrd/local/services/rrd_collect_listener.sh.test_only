#!/usr/bin/bash

. ${1}/setenv.sh
rrdtool -h > /mnt/api.pmccabe_collector.restapi.org/project/{uuid}/analytic/rrd/collect/help 2>&1
shopt -s extglob
inotifywait -m /mnt/api.pmccabe_collector.restapi.org/project/{uuid}/analytic/rrd/collect/POST -e modify --include 'exec$' |
	while read dir action file; do
		echo "file: ${file}, action; ${action}, dir: ${dir}"
		case "$action" in
			ACCESS|ATTRIB )
				"${WORK_DIR}/rrd_collect_exec.sh" /mnt/api.pmccabe_collector.restapi.org/project/{uuid}/analytic/rrd/collect ${WORK_DIR} /mnt/api.pmccabe_collector.restapi.org/project/{uuid}/analytic/rrd/collect/POST/${file}
			;;
			*)
				;;
		esac
	done
